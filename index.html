<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Futures Assets Mockup (Mobile Size + Profits)</title>

  <!-- Fonts & Icons -->
  <link href="https://db.onlinewebfonts.com/c/d05c19ccecf7003d248c60ffd6b5e8f7?family=Binance+PLEX" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root{
      --app-w: 375px;
      --bg-base:#1E2128;
      --panel-bg:#1e2127;
      --secondary-bg:#32383e;
      --text-secondary:#7c828a;
      --text-green:#3acf87;
      --text-red:#e04b4a;
      --btn-bg:#2f3339;
      --highlight:#f0b90b;

      /* tiny segmented control sizing */
      --seg-w: 170px;   /* overall width of the pill */
      --seg-h: 24px;    /* button height */
      --seg-pad: 2px;   /* outer pill padding */
      --seg-gap: 2px;   /* space between buttons */
      --seg-r: 10px;    /* outer radius */
      --seg-thumb-r: 6px;
      --seg-font: 12px; /* label size */
    }

    *{margin:0;padding:0;box-sizing:border-box}
    body{
      background:var(--bg-base);
      display:flex;justify-content:center;align-items:flex-start;
      padding:20px;min-height:100vh;color:#E1E3E8
    }
    .app{
      width:var(--app-w);max-width:100%;
      background:var(--bg-base);color:#E1E3E8;
      border:1px solid #333;border-radius:16px;overflow:hidden;position:relative;
      padding:12px 16px 80px;font-family:"Segoe UI",Roboto,sans-serif
    }
    .amount,.value,.rate{font-family:"Binance PLEX",sans-serif!important}
    button{cursor:pointer;border:none;background:transparent;font:inherit;color:inherit}

    /* ===== Exchange / Wallet segmented control (much smaller) ===== */
    .top-toggle{
      position:relative;
      width:var(--seg-w);
      margin:2px auto 6px;
      padding:var(--seg-pad);
      background:#20242c;
      border:1px solid #343a40;
      border-radius:var(--seg-r);
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:var(--seg-gap);
    }
    .top-toggle .seg-thumb{
      position:absolute;
      top:var(--seg-pad);
      bottom:var(--seg-pad);
      left:var(--seg-pad);
      width:calc(50% - var(--seg-gap));
      background:#2b303a;
      border:1px solid #3f4652;
      border-radius:var(--seg-thumb-r);
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,.02),
        0 2px 8px rgba(0,0,0,.35);
      transition:transform .25s ease;
      transform:translateX(0%); /* left = Exchange active */
    }
    .top-toggle .toggle-btn{
      position:relative;
      z-index:1;
      height:var(--seg-h);
      line-height:var(--seg-h);
      padding:0 8px;
      font-size:var(--seg-font);
      font-weight:700;
      color:#9ba3af;
      border-radius:var(--seg-thumb-r);
      letter-spacing:.2px;
    }
    .top-toggle .toggle-btn.active{ color:#fff; }

    /* ===== Upper navs ===== */
    .main-nav{display:flex;justify-content:flex-start;gap:10px;margin:2px 0 6px 0}
    .main-nav button{padding:8px 6px;font-size:13px;color:#A1A6B0}
    .main-nav button.active{color:#FFF;border-bottom:2px solid #FFF}

    .sub-toggle{display:flex;gap:6px;margin:8px 0}
    .sub-toggle .toggle-btn{padding:4px 8px;font-size:11px;color:#A1A6B0;border-radius:6px;background:transparent}
    .sub-toggle .toggle-btn.active{background:#323742;color:#FFF}

    .balance-panel{margin:12px 0}
    .balance-header{display:flex;justify-content:space-between;align-items:center;color:#A1A6B0;font-size:12px}
    .balance-header span{display:flex;align-items:center;gap:6px}
    .balance-header i{cursor:pointer;font-size:12px}
    .icon-group{display:inline-flex;gap:10px;font-size:13px;color:#E1E3E8}
    .balance-amount{display:flex;align-items:flex-end;margin:8px 0}
    .amount{font-size:28px;font-weight:600}
    .currency{margin-left:8px;color:#A1A6B0;font-size:12px}
    .realized-pnl{color:#A1A6B0;font-size:12px}

    .small-balances{display:flex;margin-top:12px;justify-content:space-between}
    .small-item{display:flex;flex-direction:column}
    .small-item .label{color:#A1A6B0;font-size:12px}
    .small-item .value{font-size:14px;font-weight:600;margin-top:4px}

    .actions{display:flex;margin:14px 0}
    .btn{flex:1;padding:8px 0;font-size:13px;margin:0 4px;border-radius:6px;background:#323742;color:#A1A6B0}
    .btn.primary,.btn.active{background:#F3BA2F;color:#1E2128}

    .sub-nav-2{display:flex;align-items:flex-end;gap:16px;margin:0 0 8px 0}
    .sub-nav-2 button{position:relative;padding:0 6px 8px;font-size:14px;font-weight:700;letter-spacing:.1px;color:var(--text-secondary);line-height:1;font-family:"Binance PLEX","Segoe UI",Roboto,sans-serif}
    .sub-nav-2 button.active{color:#fff}
    .sub-nav-2 button.active::after{
      content:"";position:absolute;bottom:0;left:50%;transform:translateX(-50%);
      width:26px;height:3px;background:var(--highlight);border-radius:2px
    }

    .feed{display:flex;flex-direction:column;gap:8px;width:100%;max-height:calc(100vh - 300px);overflow-y:auto;padding:12px 0 20px;background:var(--bg-base)}
    .feed::-webkit-scrollbar{display:none}
    .empty-state{margin:0;background:var(--panel-bg);border-radius:10px;padding:20px;text-align:center;border:1px solid #2b2f36}
    .empty-state i{font-size:28px;opacity:.9;margin-bottom:10px;display:inline-block}
    .empty-state h4{font-size:14px;margin-bottom:6px}
    .empty-state p{font-size:12px;color:var(--text-secondary);margin-bottom:12px}
    .empty-state .cta{background:#F3BA2F;color:#1E2128;font-size:12px;padding:8px 12px;border-radius:6px;display:inline-flex;align-items:center;gap:6px}

    .trade-panel{background:transparent;border:none;border-radius:10px;padding:12px 0;margin:12px 0;transition:transform .5s ease}
    .trade-panel .header{display:flex;align-items:center;margin-bottom:8px}
    .trade-panel .icon-buy{background:var(--text-green);color:#fff;width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;margin-right:8px;border-radius:2px}
    .trade-panel .symbol{font-size:14px;font-weight:600;margin-right:6px;color:#fff}
    .trade-panel .tag{background:var(--secondary-bg);color:var(--text-secondary);font-size:10px;padding:1px 4px;margin-right:4px;text-transform:uppercase;border-radius:3px}
    .trade-panel .exclamations{display:flex;margin-left:6px}
    .trade-panel .exclamations span{position:relative;width:2px;height:10px;background:var(--secondary-bg);margin:0 1px;border-radius:1px;transition:background .3s ease}
    .trade-panel .exclamations span::after{content:'';position:absolute;bottom:-3px;left:50%;transform:translateX(-50%);width:2px;height:2px;background:inherit;border-radius:50%}
    .trade-panel .exclamations span.green,.trade-panel .exclamations span.green::after{background:var(--text-green)}
    .trade-panel .share{margin-left:auto;color:#var(--text-secondary);font-size:16px;cursor:pointer}

    .trade-panel .content-columns{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:8px;gap:8px}
    .trade-panel .column{display:flex;flex-direction:column}
    .trade-panel .column.right{text-align:right}
    .trade-panel .stat{margin-bottom:8px}
    .trade-panel .label{font-size:12px;color:var(--text-secondary);border-bottom:1px dotted var(--text-secondary);padding-bottom:2px;display:inline-block}
    .trade-panel .label.no-line{border-bottom:none}
    .trade-panel .value{font-size:14px;font-weight:400;color:#fff;transition:all .3s ease}
    .trade-panel .value.green,.trade-panel .value.percent.green{color:var(--text-green);font-size:18px;font-weight:700}
    .trade-panel .value.red,.trade-panel .value.percent.red{color:var(--text-red);font-size:18px;font-weight:700}
    .trade-panel .margin-ratio-value{font-size:12px!important}

    .trade-panel .tp-actions{display:flex;justify-content:space-between;gap:8px;margin-top:2px}
    .trade-panel .tp-btn{flex:1;background:var(--btn-bg);color:#fff;border:none;border-radius:6px;padding:6px 0;font-size:12px;cursor:pointer;transition:background .3s}
    .trade-panel .tp-btn:hover{background:var(--secondary-bg)}

    .bottom-nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:var(--app-w);background:#2A2F3A;display:flex;padding:8px 0}
    .bottom-nav button{flex:1;display:flex;flex-direction:column;align-items:center;font-size:10px;color:#A1A6B0}
    .bottom-nav button.active{color:#FFF}
    .bottom-nav i{margin-bottom:4px;font-size:16px}
  </style>
</head>
<body>
  <div class="app">
    <!-- Segmented control -->
    <header class="top-toggle" aria-label="Exchange or Wallet">
      <button class="toggle-btn active" type="button">Exchange</button>
      <button class="toggle-btn" type="button">Wallet</button>
    </header>

    <nav class="main-nav" aria-label="Main sections">
      <button>Overview</button>
      <button class="active">Futures</button>
      <button>Spot</button>
      <button>Funding</button>
    </nav>

    <div class="sub-toggle" role="tablist" aria-label="Futures type">
      <button class="toggle-btn active" role="tab" aria-selected="true">USDⓢ-M</button>
      <button class="toggle-btn" role="tab" aria-selected="false">COIN-M</button>
    </div>

    <section class="balance-panel" aria-label="Balances">
      <div class="balance-header">
        <span>Margin Balance <i id="eyeToggle" class="fas fa-eye" aria-hidden="true"></i></span>
        <span class="icon-group" aria-label="Actions">
          <i class="fas fa-gift" title="Rewards"></i>
          <i class="fas fa-right-left" title="Convert"></i>
          <i class="fas fa-file-invoice" title="Statements"></i>
        </span>
      </div>

      <div class="balance-amount">
        <span id="amount" class="amount">$76,539.67</span>
        <span class="currency">USD <i class="fas fa-chevron-down" aria-hidden="true"></i></span>
      </div>

      <div class="realized-pnl" id="pnl">
        Today’s Realized PNL <span id="realizedSpan" style="color:#00ff99;">$6,543.67</span> <i class="fas fa-chevron-right" aria-hidden="true"></i>
      </div>

      <div class="small-balances">
        <div class="small-item">
          <div class="label">Wallet Balance (USD)</div>
          <div class="value" id="walletValue">$0.00</div>
        </div>
        <div class="small-item">
          <div class="label">Unrealized PNL (USD)</div>
          <div class="value" id="unrealizedValue">0.00</div>
        </div>
      </div>
    </section>

    <section class="actions" aria-label="Quick actions">
      <button class="btn primary active">Trade</button>
      <button class="btn">Swap</button>
      <button class="btn">Transfer</button>
    </section>

    <section class="positions" aria-label="Positions">
      <nav class="sub-nav-2">
        <button class="active">Positions</button>
        <button>Assets</button>
      </nav>
      <div class="feed" id="feed">
        <div class="empty-state" id="emptyState">
          <i class="fa-solid fa-briefcase"></i>
          <h4>You have no open positions</h4>
          <p>Start a trade to see it listed here in real-time.</p>
          <button class="cta"><i class="fa-solid fa-plus"></i> Open a Trade</button>
        </div>
      </div>
    </section>

    <nav class="bottom-nav" aria-label="Bottom navigation">
      <button><i class="fas fa-home"></i><span>Home</span></button>
      <button><i class="fas fa-chart-bar"></i><span>Markets</span></button>
      <button><i class="fas fa-exchange-alt"></i><span>Trade</span></button>
      <button><i class="fas fa-chart-line"></i><span>Futures</span></button>
      <button class="active"><i class="fas fa-wallet"></i><span>Assets</span></button>
    </nav>
  </div>

  <script>
    /* ===== Exchange/Wallet segmented thumb behavior ===== */
    (() => {
      const wrap = document.querySelector('.app .top-toggle');
      if (!wrap) return;
      if (!wrap.querySelector('.seg-thumb')){
        wrap.insertAdjacentHTML('afterbegin','<span class="seg-thumb" aria-hidden="true"></span>');
      }
      const btns  = [...wrap.querySelectorAll('.toggle-btn')];
      const thumb = wrap.querySelector('.seg-thumb');

      function setActive(i){
        btns.forEach((b,idx)=> b.classList.toggle('active', idx===i));
        thumb.style.transform = `translateX(${i*100}%)`; // 0% = Exchange, 100% = Wallet
      }

      const startIdx = Math.max(0, btns.findIndex(b => b.classList.contains('active')));
      setActive(startIdx);
      btns.forEach((b,i)=> b.addEventListener('click', () => setActive(i)));
    })();

    // ---------- Utilities ----------
    const fmtMoney = (n) =>
      "$" + Number(n).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    const fmtPct = (n) => (n >= 0 ? "+" : "") + n.toFixed(2) + "%";

    // Default fallbacks; will be overwritten by exchangeInfo tick sizes
    const symbolPrecisions = {
      BTCUSDT:2, ETHUSDT:2, BNBUSDT:2, ADAUSDT:4, SOLUSDT:3, XRPUSDT:4, DOTUSDT:3, LTCUSDT:2,
      LINKUSDT:3, DOGEUSDT:5, UNIUSDT:3, BCHUSDT:2, XLMUSDT:5, ATOMUSDT:3, MATICUSDT:4, AVAXUSDT:3,
      TRXUSDT:5, EOSUSDT:3, NEARUSDT:3, FILUSDT:3,
      OPUSDT:3, ARBUSDT:3, SUIUSDT:4, APTUSDT:3, FTMUSDT:4, ICPUSDT:3, SHIBUSDT:8, PEPEUSDT:8, SEIUSDT:4, INJUSDT:3
    };

    const maintRate = {
      BTCUSDT:0.004, ETHUSDT:0.005, BNBUSDT:0.005, ADAUSDT:0.010, SOLUSDT:0.008, XRPUSDT:0.010, DOTUSDT:0.010,
      LTCUSDT:0.010, LINKUSDT:0.010, DOGEUSDT:0.012, UNIUSDT:0.010, BCHUSDT:0.010, XLMUSDT:0.015, ATOMUSDT:0.010,
      MATICUSDT:0.010, AVAXUSDT:0.010, TRXUSDT:0.020, EOSUSDT:0.015, NEARUSDT:0.020, FILUSDT:0.015,
      OPUSDT:0.015, ARBUSDT:0.015, SUIUSDT:0.015, APTUSDT:0.015, FTMUSDT:0.020, ICPUSDT:0.015, SHIBUSDT:0.025,
      PEPEUSDT:0.030, SEIUSDT:0.020, INJUSDT:0.015
    };

    const getP = (sym) => symbolPrecisions[sym] ?? 2;
    const fSym = (sym, x) => {
      const p = getP(sym);
      const s = Number(x).toFixed(p);
      const [i, d] = s.split(".");
      const intFmt = i.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      return (d !== undefined) ? `${intFmt}.${d}` : intFmt;
    };

    // ---------- Top panel refs ----------
    const amountEl = document.getElementById("amount");
    const walletEl = document.getElementById("walletValue");
    const unrealEl = document.getElementById("unrealizedValue");
    const pnlEl = document.getElementById("pnl");
    const eye = document.getElementById("eyeToggle");

    const MAIN_BALANCE_TARGET = 76539.67; // Margin Balance target
    const REALIZED_TODAY = 6543.67;

    let show = true;
    let walletBalance = 0;
    let unrealizedSum = 0;

    // ---------- Trade generator ----------
    const feedDiv = document.getElementById("feed");
    const leverages = [10, 20, 50, 100];
    const MIN_MARGIN = 50, MAX_MARGIN = 1000;
    const TRADES = 24;

    const trades = [];

    function makeBars() {
      let html = "";
      const totalBars = 4;
      const greenBars = Math.floor(Math.random() * totalBars) + 1;
      for (let j = 0; j < totalBars; j++) html += `<span class="${j < greenBars ? 'green' : ''}"></span>`;
      return html;
    }

    function makePanel(sym, lev, margin, entry, mark, qty, mmr) {
      const panel = document.createElement("div");
      panel.className = "trade-panel";
      panel.innerHTML = `
        <div class="header">
          <span class="icon-buy">B</span>
          <span class="symbol">${sym}</span>
          <span class="tag">PERP</span>
          <span class="tag">Cross ${lev}×</span>
          <span class="exclamations">${makeBars()}</span>
          <i class="fas fa-share-nodes share"></i>
        </div>

        <div class="content-columns">
          <div class="column">
            <div class="stat">
              <div class="label">PNL (USDT)</div>
              <div class="value green" data-role="pnl">$0.00</div>
            </div>
            <div class="stat">
              <div class="label">Size (USDT)</div>
              <div class="value" data-role="size">$0.00</div>
            </div>
            <div class="stat">
              <div class="label">Entry Price (USDT)</div>
              <div class="value" data-role="entry">${fSym(sym, entry)}</div>
            </div>
          </div>

          <div class="column center">
            <div class="stat">
              <div class="label no-line">Margin (USDT)</div>
              <div class="value" data-role="margin">${fmtMoney(margin)}</div>
            </div>
            <div class="stat">
              <div class="label no-line">Mark Price (USDT)</div>
              <div class="value" data-role="mark">${fSym(sym, mark)}</div>
            </div>
          </div>

          <div class="column right">
            <div class="stat">
              <div class="label">ROI</div>
              <div class="value percent green" data-role="roi">+0.00%</div>
            </div>
            <div class="stat margin-ratio">
              <div class="label">Margin Ratio</div>
              <div class="value percent margin-ratio-value green" data-role="mratio">0.00%</div>
            </div>
            <div class="stat">
              <div class="label no-line">Liq. Price (USDT)</div>
              <div class="value" data-role="liq">${fSym(sym, entry * (1 - 1/lev + mmr))}</div>
            </div>
          </div>
        </div>

        <div class="tp-actions">
          <button class="tp-btn">Leverage</button>
          <button class="tp-btn">TP/SL</button>
          <button class="tp-btn">Close</button>
          <button class="tp-btn">Reverse</button>
        </div>
      `;
      feedDiv.appendChild(panel);
      return { el: panel, sym, lev, margin, entry, mark, qty, mmr };
    }

    function recalcTrade(t) {
      const pnl = (t.mark - t.entry) * t.qty;     // USDT-M Long PnL
      const roi = (pnl / t.margin) * 100;

      const sizeUSDT = Math.abs(t.qty * t.mark);
      const notional = Math.abs(t.qty * t.entry);
      const maintenance = notional * t.mmr;
      const equity = t.margin + pnl;
      const mratio = Math.max(0, (maintenance / Math.max(0.01, equity)) * 100);

      const e = (sel) => t.el.querySelector(sel);

      e('[data-role="pnl"]').textContent = fmtMoney(pnl);
      e('[data-role="pnl"]').classList.toggle('green', pnl >= 0);
      e('[data-role="pnl"]').classList.toggle('red', pnl < 0);

      e('[data-role="roi"]').textContent = fmtPct(roi);
      e('[data-role="roi"]').classList.toggle('green', roi >= 0);
      e('[data-role="roi"]').classList.toggle('red', roi < 0);

      e('[data-role="size"]').textContent = fmtMoney(sizeUSDT);
      e('[data-role="mark"]').textContent = fSym(t.sym, t.mark);
      e('[data-role="mratio"]').textContent = mratio.toFixed(2) + "%";
      e('[data-role="mratio"]').classList.toggle('green', mratio < 80);
      e('[data-role="mratio"]').classList.toggle('red', mratio >= 80);

      e('[data-role="liq"]').textContent = fSym(t.sym, t.entry * (1 - 1/t.lev + t.mmr));

      return pnl;
    }

    function refreshTop() {
      amountEl.textContent = show ? fmtMoney(walletBalance + unrealizedSum) : "•••••••";
      walletEl.textContent = show ? fmtMoney(walletBalance) : "•••••••";
      unrealEl.textContent = show ? fmtMoney(unrealizedSum) : "•••••••";
      const rs = document.getElementById("realizedSpan");
      if (rs) rs.textContent = show ? fmtMoney(REALIZED_TODAY) : "•••••••";
    }

    eye.addEventListener("click", () => {
      show = !show;
      refreshTop();
      eye.classList.toggle("fa-eye-slash", !show);
      eye.classList.toggle("fa-eye", show);
      if (!show) {
        pnlEl.innerHTML = `Today’s Realized PNL ••••••• <i class='fas fa-chevron-right'></i>`;
      } else {
        pnlEl.innerHTML = `Today’s Realized PNL <span id="realizedSpan" style="color:#00ff99;">${fmtMoney(REALIZED_TODAY)}</span> <i class="fas fa-chevron-right"></i>`;
      }
    });

    // ---------- Init ----------
    async function initTrades() {
      try {
        // 1) Get current prices
        const res = await fetch("https://api.binance.com/api/v3/ticker/price");
        const data = await res.json();
        const priceMap = Object.fromEntries(data.map(d => [d.symbol, parseFloat(d.price)]));

        // 2) Precisions from exchangeInfo (to mirror real decimals)
        const wanted = JSON.stringify(Object.keys(symbolPrecisions));
        try {
          const exRes = await fetch("https://api.binance.com/api/v3/exchangeInfo?symbols=" + encodeURIComponent(wanted));
          const ex = await exRes.json();
          if (ex && Array.isArray(ex.symbols)) {
            ex.symbols.forEach(s => {
              const pf = (s.filters || []).find(f => f.filterType === "PRICE_FILTER");
              if (pf && typeof pf.tickSize === "string") {
                const dec = pf.tickSize.includes(".")
                  ? pf.tickSize.split(".")[1].replace(/0+$/,"").length
                  : 0;
                symbolPrecisions[s.symbol] = Math.max(dec, 0);
              }
            });
          }
        } catch (e) {
          console.warn("exchangeInfo precision fetch failed:", e);
        }

        // Clear empty state
        const empty = document.getElementById("emptyState");
        if (empty) empty.remove();

        // 3) Build trades
        const pick = Object.keys(symbolPrecisions);
        const leverages = [10,20,50,100];
        for (let i = 0; i < TRADES; i++) {
          const sym = pick[i % pick.length];
          const live = priceMap[sym];
          if (!live || isNaN(live)) continue;

          const lev = leverages[Math.floor(Math.random() * leverages.length)];
          const margin = Math.random() * (1000 - 50) + 50;

          const entry = live * 0.94;
          const mark  = live * 0.98;

          const qty = (margin * lev) / entry;
          const mmr = maintRate[sym] ?? 0.01;

          const t = makePanel(sym, lev, margin, entry, mark, qty, mmr);
          trades.push(t);
        }

        // 4) Compute sums and top balances
        unrealizedSum = 0;
        trades.forEach(t => unrealizedSum += recalcTrade(t));

        // Choose wallet so Margin Balance hits target initially
        const MAIN_BALANCE_TARGET = 76539.67;
        walletBalance = MAIN_BALANCE_TARGET - unrealizedSum;
        refreshTop();

        // 5) Animate marks
        setInterval(() => {
          unrealizedSum = 0;
          trades.forEach(t => {
            const drift = (Math.random() * 0.08 - 0.04) / 100; // +/- 0.04%
            t.mark = Math.max(0.00000001, t.mark * (1 + drift));
            unrealizedSum += recalcTrade(t);
          });
          refreshTop();
        }, 1800);

      } catch (err) {
        console.error("Failed to initialize:", err);
        const empty = document.getElementById("emptyState");
        if (empty) empty.querySelector("p").textContent = "Network error. Please reload.";
      }
    }

    // Seed top while loading
    amountEl.textContent = "$76,539.67";
    const rs = document.getElementById("realizedSpan");
    if (rs) rs.textContent = "$6,543.67";
    walletEl.textContent = "Loading…";
    unrealEl.textContent = "Loading…";

    initTrades();
  </script>
</body>
</html>
